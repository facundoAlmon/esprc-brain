<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title data-i18n="appTitle">ESPRC Command Center</title><link rel="icon" href="data:,"><style>@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}:root{--background-color:#0D0D1A;--surface-color:#0B172E;--primary-color:#1E90FF;--secondary-color:#00F5D4;--danger-color:#FF4757;--text-color:#E0E0E0;--text-muted-color:#A0A0B0;--border-color:rgba(30, 144, 255, 0.4);--glow-color:rgba(30, 144, 255, 0.3);--font-family:'Orbitron',sans-serif;--joystick-bg-color:rgba(0, 245, 212, 0.1);--joystick-border-color:var(--secondary-color);--joystick-handle-color:var(--primary-color);--joystick-handle-stroke-color:#104E8B}.light-mode{--background-color:#f0f4f8;--surface-color:#ffffff;--primary-color:#007BFF;--secondary-color:#009688;--danger-color:#d9534f;--text-color:#333;--text-muted-color:#666;--border-color:#ddd;--glow-color:rgba(0, 123, 255, 0.2);--joystick-bg-color:#e0e0e0;--joystick-border-color:var(--secondary-color);--joystick-handle-color:var(--primary-color);--joystick-handle-stroke-color:#0056b3}*{box-sizing:border-box;margin:0;padding:0}body,input[type=number],input[type=password],input[type=text],select{font-family:var(--font-family);background-color:var(--background-color);color:var(--text-color)}body{flex-direction:column;min-height:100vh;font-weight:400;display:flex;transition:background-color .3s,color .3s}#sidebar{width:260px;height:100vh;position:fixed;top:0;left:0;background-color:var(--background-color);border-right:1px solid var(--border-color);transform:translateX(0);transition:transform .3s ease-in-out;z-index:1000}#sidebar.sidebar-hidden{transform:translateX(-100%)}.sidebar-header{padding:1.5rem;text-align:center;border-bottom:1px solid var(--border-color)}.sidebar-header h2,h1{margin:0;font-size:1.5rem;color:var(--secondary-color)}.menu-links{list-style:none;padding:1rem 0}.menu-link{display:flex;align-items:center;gap:1rem;padding:1rem 1.5rem;cursor:pointer;border:0;background-color:transparent;font-size:1rem;font-family:var(--font-family);color:var(--text-muted-color);transition:all .3s ease;width:100%;text-align:left}.menu-link svg{fill:var(--text-muted-color);transition:all .3s ease;width:24px;height:24px;flex-shrink:0}.menu-link:hover{background-color:var(--glow-color);color:var(--primary-color)}.menu-link:hover svg,button.icon-toggle:hover svg{fill:var(--primary-color)}.menu-link.active{background-color:var(--surface-color);color:var(--secondary-color);box-shadow:inset 4px 0 0 var(--secondary-color)}.menu-link.active svg{fill:var(--secondary-color)}.main-wrapper{margin-left:260px;width:calc(100% - 260px);transition:margin-left .3s ease-in-out,width .3s ease-in-out;padding:1rem}.main-wrapper.full-width{margin-left:0;width:100%}header{display:flex;justify-content:space-between;align-items:center;padding-bottom:1rem;border-bottom:1px solid var(--border-color);margin-bottom:1rem}#menu-toggle{background:0 0;border:0;cursor:pointer;padding:.5rem;display:none}#menu-toggle svg{fill:var(--text-color)}h1{font-size:1.8rem;font-weight:700;text-shadow:0 0 5px var(--secondary-color)}.tab-content{display:none;animation:fadeIn .5s;background-color:var(--surface-color);border:1px solid var(--border-color);padding:1.5rem;clip-path:polygon(0 0,calc(100% - 20px) 0,100% 20px,100% 100%,20px 100%,0 calc(100% - 20px))}.tab-content.active{display:block}.joystick-layout-single,.joystick-layout-split{display:grid;gap:2rem;align-items:center}.joystick-layout-single{grid-template-columns:1fr 300px}.joystick-layout-split{grid-template-columns:1fr 300px 1fr}.joystick-container{text-align:center}#joy1Div,#joy2ADiv,#joy2BDiv{width:100%;max-width:300px;aspect-ratio:1/1;background-color:var(--joystick-bg-color);border-radius:50%;margin:0 auto;border:2px solid var(--joystick-border-color);box-shadow:inset 0 0 20px rgba(0,0,0,.5)}.joystick-info{margin-top:1rem;font-size:.9rem;color:var(--text-muted-color)}.joystick-info-card{background:rgba(0,0,0,.2);padding:1.5rem;border:1px solid var(--border-color);clip-path:polygon(10px 0,100% 0,100% calc(100% - 10px),calc(100% - 10px) 100%,0 100%,0 10px)}.joystick-info-card h2{font-size:1.2rem;margin-bottom:1rem}.joystick-info-card .control-group{margin-top:1rem}.circular-controls{position:relative;width:180px;height:180px;margin:2rem auto}.circular-controls .icon-toggle{position:absolute;width:50px;height:50px;border-radius:50%;transition:all .3s ease}.control-btn-up{top:0;left:50%;transform:translateX(-50%)}.control-btn-left{top:50%;left:0;transform:translateY(-50%)}.control-btn-right{top:50%;right:0;transform:translateY(-50%)}.control-btn-center{top:50%;left:50%;transform:translate(-50%,-50%);width:60px;height:60px}.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem}.form-group{display:flex;flex-direction:column;gap:.5rem}.form-group label{font-weight:700;text-transform:uppercase;font-size:.9rem;color:var(--text-muted-color)}input[type=number],input[type=password],input[type=text],select{width:100%;padding:.75rem;border:1px solid var(--border-color);border-radius:0;font-size:1rem;transition:all .3s;clip-path:polygon(5px 0,100% 0,100% calc(100% - 5px),calc(100% - 5px) 100%,0 100%,0 5px)}input[type=number]:focus,input[type=password]:focus,input[type=text]:focus,select:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 10px var(--glow-color)}input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:5px;background:var(--surface-color);border:1px solid var(--border-color);outline:0}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;background:var(--primary-color);cursor:pointer;border:2px solid var(--secondary-color);box-shadow:0 0 5px var(--secondary-color);transition:.3s}input[type=range]::-moz-range-thumb{width:20px;height:20px;background:var(--primary-color);cursor:pointer;border:2px solid var(--secondary-color)}.slider-group label{display:flex;justify-content:space-between}.radio-group{display:flex;gap:1rem;align-items:center}.button-group{margin-top:1.5rem;display:flex;gap:1rem;justify-content:flex-end;flex-wrap:wrap}button{padding:.75rem 1.5rem;border:1px solid var(--primary-color);border-radius:0;background-color:transparent;color:var(--primary-color);font-size:1rem;font-family:var(--font-family);font-weight:700;cursor:pointer;transition:all .3s;position:relative;overflow:hidden;clip-path:polygon(10px 0,100% 0,100% calc(100% - 10px),calc(100% - 10px) 100%,0 100%,0 10px)}button:hover{background-color:var(--primary-color);color:#fff;box-shadow:0 0 15px var(--glow-color)}button:active{transform:scale(.98)}button.secondary{border-color:var(--secondary-color);color:var(--secondary-color)}button.secondary:hover{background-color:var(--secondary-color);color:var(--background-color)}button.danger{border-color:var(--danger-color);color:var(--danger-color)}button.danger:hover{background-color:var(--danger-color);color:#fff}.led-config-grid{grid-template-columns:1fr auto}.led-main-buttons{justify-content:flex-end}#led-groups-container{margin-top:1.5rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1.5rem}.led-group-card{background-color:rgba(0,0,0,.2);border:1px solid var(--border-color);padding:1rem;display:flex;flex-direction:column;gap:1rem;clip-path:polygon(10px 0,100% 0,100% calc(100% - 10px),calc(100% - 10px) 100%,0 100%,0 10px)}.remove-led-group{align-self:flex-end}.control-group{display:flex;justify-content:space-between;align-items:center}.toggle{appearance:none;width:50px;height:24px;position:relative;border-radius:24px;cursor:pointer;background-color:var(--surface-color);border:1px solid var(--border-color);transition:background-color .3s}.toggle::before{content:"";position:absolute;width:18px;height:18px;border-radius:50%;background:var(--text-muted-color);top:2px;left:2px;transition:all .3s}.toggle:checked{background-color:var(--primary-color);border-color:var(--primary-color)}.toggle:checked::before{background:var(--secondary-color);transform:translateX(26px)}.cam-container{display:grid;grid-template-columns:2fr 1fr;gap:2rem}.cam-stream{position:relative}.cam-stream img{width:100%;height:auto;background-color:#000;border:1px solid var(--border-color);clip-path:polygon(0 0,calc(100% - 15px) 0,100% 15px,100% 100%,15px 100%,0 calc(100% - 15px))}.cam-overlay{position:absolute;bottom:0;left:0;right:0;padding:1rem;background:linear-gradient(to top,rgba(0,0,0,.8),transparent);display:flex;justify-content:space-between;align-items:center}.cam-overlay .button-group{margin:0}.theme-switch-wrapper{display:flex;align-items:center;gap:.5rem;color:var(--text-muted-color)}.theme-switch{position:relative;display:inline-block;width:50px;height:24px}.theme-switch input{opacity:0;width:0;height:0}.slider,.slider:before{position:absolute;transition:.4s}.slider{cursor:pointer;top:0;right:0;border:1px solid var(--border-color);left:0;bottom:0;background-color:var(--surface-color)}.slider:before{content:"";height:18px;width:18px;left:2px;bottom:2px;background-color:var(--text-muted-color)}input:checked+.slider{background-color:var(--primary-color)}input:checked+.slider:before{transform:translateX(26px);background-color:#fff}.slider.round{border-radius:34px}.slider.round:before{border-radius:50%}@media (max-width:1200px){.cam-container,.joystick-layout-single{grid-template-columns:1fr}}@media (max-width:992px){#menu-toggle{display:block}.joystick-layout-single{display:flex;flex-direction:column;gap:1rem}.joystick-layout-single.swapped{flex-direction:column-reverse}.joystick-layout-split{grid-template-columns:1fr;grid-template-rows:auto auto auto;gap:1.5rem}.joystick-layout-split>.joystick-container:nth-child(1){grid-row:1}.joystick-layout-split>.joystick-info-card:nth-child(2){grid-row:2}.joystick-layout-split>.joystick-container:nth-child(3){grid-row:3}}@media (max-width:992px) and (orientation:landscape){.joystick-layout-single,.joystick-layout-split{display:flex;flex-direction:row;justify-content:space-around;align-items:center;gap:1rem}.joystick-layout-single.swapped{flex-direction:row-reverse}.joystick-layout-single>.joystick-container,.joystick-layout-single>.joystick-info-card{flex:1 1 50%}.joystick-layout-split{justify-content:space-between;width:100%;gap:.5rem}.joystick-layout-split>.joystick-container{flex:1 1 35%;display:flex;justify-content:center;align-items:center}.joystick-layout-split>.joystick-info-card{flex:0 0 auto;padding:.25rem}#joy1Div,#joy2ADiv,#joy2BDiv{width:100%;max-width:300px}.joystick-layout-split .joystick-info-card h2{font-size:.9rem;margin-bottom:.25rem}.joystick-layout-split .joystick-info-card .control-group{margin-top:.25rem}.joystick-layout-split .circular-controls{width:120px;height:120px;margin:.25rem auto}.joystick-layout-split .circular-controls .icon-toggle{width:30px;height:30px}.joystick-layout-split .circular-controls .icon-toggle svg{width:18px;height:18px}.joystick-layout-split .control-btn-center{width:40px;height:40px}}@media (max-width:768px){.action-card .duration-controls,.action-card .form-grid{flex-direction:column;align-items:stretch}.action-card .duration-controls input[type=number]{width:100%}.header-controls{flex-basis:100%;justify-content:space-between;margin-top:1rem}header{flex-wrap:wrap}h1{font-size:1.4rem}.tab-link{font-size:.9rem;padding:.7rem 1rem;justify-content:center}.tab-link span{display:none}.form-grid,.led-config-grid{grid-template-columns:1fr}.button-group,.led-main-buttons{justify-content:flex-start}}.settings-section{margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border-color)}.settings-section:first-child{margin-top:0;padding-top:0;border-top:none}.action-card-header h5,.settings-section h3{font-size:1.1rem;color:var(--secondary-color)}.settings-section h3{margin-bottom:1rem}.control-group{padding:.5rem 0}.control-group span{font-weight:700;text-transform:uppercase;font-size:.9rem;color:var(--text-muted-color)}button.icon-toggle{padding:0;width:40px;height:40px;clip-path:none;border-radius:50%;display:flex;align-items:center;justify-content:center;border-color:var(--border-color)}button.icon-toggle svg{width:24px;height:24px;fill:var(--text-muted-color);transition:all .3s ease}button.icon-toggle:hover{border-color:var(--primary-color)}button.icon-toggle.active{background-color:var(--secondary-color);border-color:var(--secondary-color);box-shadow:0 0 10px var(--secondary-color)}button.icon-toggle.active svg{fill:var(--background-color)}.tooltip{position:fixed;padding:8px 12px;background-color:var(--primary-color);color:#fff;border-radius:4px;font-size:.9rem;font-family:sans-serif;z-index:2000;pointer-events:none;opacity:0;transform:scale(.9);transition:opacity .2s,transform .2s;white-space:nowrap}.tooltip.visible{opacity:1;transform:scale(1)}#program-controls .button-group{justify-content:flex-start;flex-wrap:wrap}.action-card{background-color:var(--background-color);border:1px solid var(--border-color);padding:1rem;clip-path:polygon(10px 0,100% 0,100% calc(100% - 10px),calc(100% - 10px) 100%,0 100%,0 10px);cursor:auto}#program-sequence-container{margin-top:1.5rem;display:flex;flex-direction:column;gap:1rem;min-height:200px;border:2px dashed var(--border-color);padding:1rem;border-radius:4px}.action-card.dragging{opacity:.5;background:var(--glow-color)}.action-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.action-card-header h5{margin:0}.action-card-header div{display:flex;gap:.5rem}.drag-handle{cursor:grab;color:var(--text-muted-color);margin-right:1rem}.delete-action-btn,.duplicate-action-btn{padding:.2rem .5rem;font-size:.9rem;clip-path:none;border-radius:4px}#program-add-action-area{text-align:center;margin-top:1.5rem}.action-card-footer{margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border-color)}.duration-controls{display:flex;align-items:center;gap:1rem}.duration-controls input[type=range]{flex-grow:1}.duration-controls input[type=number]{width:100px}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:2000;animation:fadeIn .3s}.modal-content{background-color:var(--surface-color);padding:2rem;border:1px solid var(--primary-color);box-shadow:0 0 20px var(--glow-color);text-align:center;clip-path:polygon(15px 0,100% 0,100% calc(100% - 15px),calc(100% - 15px) 100%,0 100%,0 15px)}.modal-actions{display:flex;gap:1rem;margin:1.5rem 0}.modal-action-btn{min-width:120px}.joystick-layout-single.swapped{grid-template-columns:300px 1fr}.joystick-layout-single.swapped .joystick-container{grid-column:2}.joystick-layout-single.swapped .joystick-info-card{grid-column:1}</style></head><body><nav id="sidebar"><div class="sidebar-header"><h2 data-i18n="menu">Menu</h2></div><ul class="menu-links"><li><button class="menu-link active" data-tab="joystick-a"><svg xmlns="http://www.w3.org/2000/svg" width="200" height="24" viewBox="0 0 16 16"><g fill="currentColor"><path d="M10 2a2 2 0 0 1-1.5 1.937v5.087c.863.083 1.5.377 1.5.726c0 .414-.895.75-2 .75s-2-.336-2-.75c0-.35.637-.643 1.5-.726V3.937A2 2 0 1 1 10 2z"/><path d="M0 9.665v1.717a1 1 0 0 0 .553.894l6.553 3.277a2 2 0 0 0 1.788 0l6.553-3.277a1 1 0 0 0 .553-.894V9.665c0-.1-.06-.19-.152-.23L9.5 6.715v.993l5.227 2.178a.125.125 0 0 1 .001.23l-5.94 2.546a2 2 0 0 1-1.576 0l-5.94-2.546a.125.125 0 0 1 .001-.23L6.5 7.708l-.013-.988L.152 9.435a.25.25 0 0 0-.152.23z"/></g></svg> <span data-i18n="joystickA">JoyStick A</span></button></li><li><button class="menu-link" data-tab="joystick-b"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M22 8.65A5 5 0 0 0 17 4H7a5 5 0 0 0-5 4.74A2 2 0 0 0 2 9v7.5A3.48 3.48 0 0 0 5.5 20c1.43 0 2.32-1.06 3.19-2.09c.32-.37.65-.76 1-1.1a4.81 4.81 0 0 1 1.54-.75a6.61 6.61 0 0 1 1.54 0a4.81 4.81 0 0 1 1.54 .75c.35.34.68.73 1 1.1c.87 1 1.76 2.09 3.19 2.09a3.48 3.48 0 0 0 3.5-3.5V9a2.09 2.09 0 0 0 0-.26zm-2 7.85a1.5 1.5 0 0 1-1.5 1.5c-.5 0-1-.64-1.66-1.38c-.34-.39-.72-.85-1.15-1.26a6.68 6.68 0 0 0-2.46-1.25a6.93 6.93 0 0 0-2.46 0a6.68 6.68 0 0 0-2.46 1.25c-.43.41-.81.87-1.15 1.26C6.54 17.36 6 18 5.5 18A1.5 1.5 0 0 1 4 16.5V9a.77.77 0 0 0 0-.15A3 3 0 0 1 7 6h10a3 3 0 0 1 3 2.72v.12A.86.86 0 0 0 20 9z"/><circle cx="16" cy="12" r="1" fill="currentColor"/><circle cx="18" cy="10" r="1" fill="currentColor"/><circle cx="16" cy="8" r="1" fill="currentColor"/><circle cx="14" cy="10" r="1" fill="currentColor"/><circle cx="8" cy="10" r="2" fill="currentColor"/></svg> <span data-i18n="joystickB">JoyStick B</span></button></li><li><button class="menu-link" data-tab="program"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h2"/><path d="M6 12h2"/><path d="M10 12h2"/><path d="M14 12h2"/><path d="M18 12h2"/><rect x="3" y="8" width="18" height="8" rx="1"/></svg> <span data-i18n="program">Program</span></button></li><li><button class="menu-link" data-tab="conexion"><svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M0 7L1.17157 5.82843C2.98259 4.01741 5.43884 3 8 3C10.5612 3 13.0174 4.01742 14.8284 5.82843L16 7L14.5858 8.41421L13.4142 7.24264C11.9783 5.8067 10.0307 5 8 5C5.96928 5 4.02173 5.8067 2.58579 7.24264L1.41421 8.41421L0 7Z" fill="currentColor"/><path d="M4.24264 11.2426L2.82843 9.82843L4 8.65685C5.06086 7.59599 6.49971 7 8 7C9.50029 7 10.9391 7.59599 12 8.65686L13.1716 9.82843L11.7574 11.2426L10.5858 10.0711C9.89999 9.38527 8.96986 9 8 9C7.03014 9 6.1 9.38527 5.41421 10.0711L4.24264 11.2426Z" fill="currentColor"/><path d="M8 15L5.65685 12.6569L6.82842 11.4853C7.13914 11.1746 7.56057 11 8 11C8.43942 11 8.86085 11.1746 9.17157 11.4853L10.3431 12.6569L8 15Z" fill="currentColor"/></svg> <span data-i18n="connection">Connection</span></button></li><li><button class="menu-link" data-tab="config"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M20.96 16.45c.01-.15.04-.3.04-.45v.5l-.04-.05M11 16c0 .71.15 1.39.42 2H6v1c0 .55-.45 1-1 1H4c-.55 0-1-.45-1-1v-8l2.08-6c.2-.58.76-1 1.42-1h11c.66 0 1.22.42 1.42 1L21 11v5c0-2.76-2.24-5-5-5s-5 2.24-5 5m-3-2.5c0-.83-.67-1.5-1.5-1.5S5 12.67 5 13.5S5.67 15 6.5 15S8 14.33 8 13.5M19 10l-1.5-4.5h-11L5 10h14m3.87 11.19l-4.11-4.11c.41-1.04.18-2.26-.68-3.11c-.9-.91-2.25-1.09-3.34-.59l1.94 1.94l-1.35 1.36l-1.99-1.95c-.54 1.09-.29 2.44.59 3.35a2.91 2.91 0 0 0 3.12.68l4.11 4.1c.18.19.45.19.63 0l1.04-1.03c.22-.18.22-.5.04-.64Z"/></svg> <span data-i18n="carConfig">Car Config</span></button></li><li><button class="menu-link" data-tab="led-config"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 3.75c2.928 0 5.25 2.275 5.25 5.02c0 1.71-.44 2.581-.998 3.373q-.19.266-.417.56c-.524.685-1.154 1.51-1.601 2.699a3.5 3.5 0 0 1-.353.698l-.056.08a3 3 0 0 1-.42.482c-.406.372-.894.588-1.405.588c-.51 0-.999-.216-1.406-.588a3 3 0 0 1-.42-.483l-.055-.08a3.5 3.5 0 0 1-.353-.697c-.447-1.19-1.077-2.014-1.601-2.7a18 18 0 0 1-.417-.56c-.557-.79-.998-1.662-.998-3.373C6.75 6.025 9.073 3.75 12 3.75m3.167 13.119c.192-.3.35-.617.471-.94c.362-.963.818-1.562 1.318-2.217c.17-.223.345-.453.523-.706c.71-1.008 1.271-2.175 1.271-4.237c0-3.628-3.05-6.519-6.75-6.519S5.25 5.141 5.25 8.77c0 2.06.561 3.228 1.271 4.236c.178.253.353.483.523.706c.5.655.956 1.254 1.318 2.217c.121.323.28.64.471.94l.222 2.216a2.96 2.96 0 0 0 5.89 0zm-1.66 1.53l-.054.536a1.46 1.46 0 0 1-2.906 0l-.053-.536c.45.222.955.351 1.506.351c.55 0 1.056-.13 1.506-.351M2.423 3.019a.75.75 0 0 1 1.056-.095l1.5 1.25a.75.75 0 0 1-.96 1.152l-1.5-1.25a.75.75 0 0 1-.096-1.056m19.152 0a.75.75 0 0 1-.096 1.057l-1.5 1.25a.75.75 0 1 1-.96-1.152l1.5-1.25a.75.75 0 0 1 1.056.096M1.25 8.25A.75.75 0 0 1 2 7.5h2A.75.75 0 0 1 4 9H2a.75.75 0 0 1-.75-.75m18 0A.75.75 0 0 1 20 7.5h2A.75.75 0 0 1 22 9h-2a.75.75 0 0 1-.75-.75M5.17 11.915a.75.75 0 0 1-.335 1.006l-1.5.75a.75.75 0 1 1-.67-1.342l1.5-.75a.75.75 0 0 1 1.006.336m13.66 0a.75.75 0 0 1 1.005-.336l1.5.75a.75.75 0 1 1-.67 1.342l-1.5-.75a.75.75 0 0 1-.336-1.006"/></svg> <span data-i18n="ledConfig">LED Config</span></button></li><li><button class="menu-link" data-tab="manage"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M15 9H9v6h6V9zm-2 4h-2v-2h2v2zm8-2V9h-2V7c0-1.1-.9-2-2-2h-2V3h-2v2h-2V3H9v2H7c-1.1 0-2 .9-2 2v2H3v2h2v2H3v2h2v2c0 1.1.9 2 2 2h2v2h2v-2h2v2h2v-2h2c1.1 0 2-.9 2-2v-2h2v-2h-2v-2h2zm-4 6H7V7h10v10z"/></svg> <span data-i18n="espManage">ESP32 Manage</span></button></li><li style="display:none"><button class="menu-link" data-tab="cam"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg> <span data-i18n="camera">Camera</span></button></li><li><button class="menu-link" data-tab="settings"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 26 26"><path d="m11.469.969l-.563 3.562A8.704 8.704 0 0 0 8.5 5.5L5.562 3.406L3.438 5.531L5.5 8.47a8.767 8.767 0 0 0-1 2.406l-3.531.594v3l3.531.625a8.683 8.683 0 0 0 1 2.406l-2.094 2.938l2.125 2.125L8.47 20.5a8.717 8.717 0 0 0 2.406.969l.594 3.562h3l.656-3.562a8.627 8.627 0 0 0 2.375-1l2.969 2.093l2.125-2.125L20.47 17.5c.438-.73.79-1.526 1-2.375l3.562-.656v-3l-3.562-.594a8.746 8.746 0 0 0-1-2.375l2.093-2.969l-2.125-2.125L17.5 5.531a8.767 8.767 0 0 0-2.406-1L14.469.97h-3zM13 6.469A6.535 6.535 0 0 1 19.531 13A6.535 6.535 0 0 1 13 19.531A6.536 6.536 0 0 1 6.469 13A6.536 6.536 0 0 1 13 6.469zm0 1.593A4.949 4.949 0 0 0 8.062 13A4.949 4.949 0 0 0 13 17.938A4.949 4.949 0 0 0 17.938 13A4.949 4.949 0 0 0 13 8.062zm-.031 2.876c1.146 0 2.094.915 2.094 2.062c0 1.146-.948 2.063-2.094 2.063A2.054 2.054 0 0 1 10.906 13c0-1.147.917-2.063 2.063-2.063z"/></svg> <span data-i18n="settings">Settings</span></button></li></ul></nav><div class="main-wrapper"><header><button id="menu-toggle"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></button><h1 data-i18n="appTitle">ESPRC Command Center</h1><div class="header-controls"></div></header><main><div id="joystick-a" class="tab-content active"><div class="joystick-layout-single"><div class="joystick-container"><div id="joy1Div"></div></div><div class="joystick-info-card"><h2 data-i18n="controls">CONTROLS</h2><div class="circular-controls"><button class="icon-toggle control-btn-up" id="headlights-btn-a" data-tooltip-key="headlights"></button> <button class="icon-toggle control-btn-left" id="turn-left-btn-a" data-tooltip-key="turnLeft"></button> <button class="icon-toggle control-btn-center" id="hazard-btn-a" data-tooltip-key="hazardLights"></button> <button class="icon-toggle control-btn-right" id="turn-right-btn-a" data-tooltip-key="turnRight"></button> <button class="icon-toggle" id="swap-layout-btn-a" data-tooltip-key="swapLayout"></button></div></div></div></div><div id="joystick-b" class="tab-content"><div class="joystick-layout-split"><div class="joystick-container"><div id="joy2ADiv"></div></div><div class="joystick-info-card"><h2 data-i18n="controls">CONTROLS</h2><div class="control-group"><button class="icon-toggle" id="acelIzq" data-tooltip-key="throttleOnLeft"></button></div><div class="circular-controls"><button class="icon-toggle control-btn-up" id="headlights-btn-b" data-tooltip-key="headlights"></button> <button class="icon-toggle control-btn-left" id="turn-left-btn-b" data-tooltip-key="turnLeft"></button> <button class="icon-toggle control-btn-center" id="hazard-btn-b" data-tooltip-key="hazardLights"></button> <button class="icon-toggle control-btn-right" id="turn-right-btn-b" data-tooltip-key="turnRight"></button></div></div><div class="joystick-container"><div id="joy2BDiv"></div></div></div></div><div id="program" class="tab-content"><h2 data-i18n="programTitle">Program Sequence</h2><div class="settings-section" id="program-controls"><div class="button-group"><button id="loadProgramBtn" class="secondary" data-i18n="loadProgram">Load from ESP</button> <button id="uploadProgramBtn" data-i18n="uploadProgram">Upload to ESP</button> <button id="runProgramBtn" data-i18n="runProgram">▶️ Run</button> <button id="stopProgramBtn" data-i18n="stopProgram">⏹️ Stop</button> <button id="clearProgramBtn" class="danger" data-i18n="clearProgram">🗑️ Clear All</button></div></div><div class="settings-section" id="program-sequence-container"></div><div class="settings-section" id="program-add-action-area"><button id="addActionBtn" class="secondary">+ <span data-i18n="addAction">Add Action</span></button></div></div><div id="conexion" class="tab-content"><h2 data-i18n="connectionSettings">Connection Settings</h2><div class="settings-section"><h3 data-i18n="networkAddresses">Network Addresses</h3><div class="form-grid"><div class="form-group"><label for="ip" data-i18n="ipAddress">IP Address</label> <input type="text" id="ip" readonly="readonly"></div><div class="form-group"><label for="urlWS" data-i18n="websocketURL">WebSocket URL</label> <input type="text" id="urlWS"></div><div class="form-group"><label for="urlAPI" data-i18n="apiURL">API URL</label> <input type="text" id="urlAPI"></div></div></div><div class="settings-section"><h3 data-i18n="wifiConfig">WiFi Configuration</h3><div class="form-grid"><div class="form-group"><label data-i18n="wifiMode">WiFi Mode</label><div class="radio-group"><input type="radio" id="cliMode" name="wifiMode" value="CLI"> <label for="cliMode" data-i18n="client">Client</label> <input type="radio" id="apMode" name="wifiMode" value="AP"> <label for="apMode" data-i18n="accessPoint">Access Point</label></div></div><div class="form-group"><label for="wifiName" data-i18n="wifiSSID">WiFi SSID</label> <input type="text" id="wifiName"></div><div class="form-group"><label for="wifiPass" data-i18n="wifiPassword">WiFi Password</label> <input type="password" id="wifiPass"></div></div></div><div class="button-group"><button id="getWifiConfigBtn" data-i18n="refresh">Refresh</button> <button id="saveWifiConfigBtn" data-i18n="save">Save</button> <button id="wsReconnectBtn" data-i18n="reconnectWS">Reconnect WS</button></div></div><div id="config" class="tab-content"><h2 data-i18n="carConfiguration">Car Configuration</h2><div class="settings-section"><h3 data-i18n="throttleSettings">Throttle Settings</h3><div class="form-grid"><div class="form-group slider-group"><label for="motorMaxSpeed"><span data-i18n="maxSpeed">Max Speed</span>: <span id="motorMaxSpeedValue">200</span></label> <input type="range" value="200" min="0" max="255" id="motorMaxSpeed"></div><div class="form-group slider-group"><label for="motorMinSpeed"><span data-i18n="minSpeed">Min Speed</span>: <span id="motorMinSpeedValue">55</span></label> <input type="range" value="55" min="0" max="255" id="motorMinSpeed"></div></div></div><div class="settings-section"><h3 data-i18n="steeringSettings">Steering Settings</h3><div class="form-grid"><div class="form-group slider-group"><label for="servoCenterDeg"><span data-i18n="alignment">Alignment</span>: <span id="servoCenterDegValue">95</span></label> <input type="range" value="95" min="0" max="180" id="servoCenterDeg"></div><div class="form-group slider-group"><label for="servoLimitLDeg"><span data-i18n="leftTurnLimit">Left Turn Limit</span>: <span id="servoLimitLDegValue">35</span></label> <input type="range" value="35" min="0" max="90" id="servoLimitLDeg"></div><div class="form-group slider-group"><label for="servoLimitRDeg"><span data-i18n="rightTurnLimit">Right Turn Limit</span>: <span id="servoLimitRDegValue">35</span></label> <input type="range" value="35" min="0" max="90" id="servoLimitRDeg"></div></div></div><div class="settings-section"><h3 data-i18n="autoLights">Automatic Lights</h3><div class="control-group"><span data-i18n="autoTurnSignals">Auto Turn Signals</span> <input class="toggle" id="autoTurnSignals" type="checkbox" data-tooltip-key="autoTurnSignals"></div><div class="form-group slider-group"><label for="autoTurnTol"><span data-i18n="autoTurnTol">Auto Turn Signals Threshold</span>: <span id="autoTurnTolValue">10</span>%</label> <input type="range" value="10" min="0" max="100" id="autoTurnTol"></div></div><div class="settings-section"><h3 data-i18n="otherSettings">Other Settings</h3><div class="control-group"><span data-i18n="enableBluetooth">Enable Bluetooth</span> <input class="toggle" id="enableScan" type="checkbox" data-tooltip-key="enableBluetooth"></div></div><div class="button-group"><button id="getConfigBtn" data-i18n="refresh">Refresh</button> <button id="saveConfigBtn" data-i18n="save">Save</button></div></div><div id="led-config" class="tab-content"><h2 data-i18n="ledConfiguration">LED Configuration</h2><div class="form-grid led-config-grid"><div class="form-group"><label for="total_leds" data-i18n="totalLeds">Total LEDs in Strip</label> <input type="number" id="total_leds" value="12" min="1"></div><div class="button-group led-main-buttons"><button id="add-led-group" data-i18n="addGroup">Add Group</button> <button class="secondary" id="exportLedConfigBtn" data-i18n="export">Export</button> <button class="secondary" onclick='document.getElementById("import-led-input").click()' data-i18n="import">Import</button> <input type="file" id="import-led-input" style="display:none" accept=".json"> <button id="saveLedConfigBtn" data-i18n="saveLedConfig">Save LED Config</button></div></div><div id="led-groups-container"></div></div><div id="manage" class="tab-content"><h2 data-i18n="espManagement">ESP32 Management</h2><div class="control-group"><label for="clearPreferences" data-i18n="clearNvs">Clear NVS Configuration</label> <input class="toggle" id="clearPreferences" type="checkbox"></div><div class="button-group"><button id="manageESPBtn" class="danger" data-i18n="restartEsp">Restart ESP32</button></div></div><div id="cam" class="tab-content"><div class="cam-container"><div class="cam-stream"><img src="" alt="Camera Stream" id="camImg"><div class="cam-overlay"><p>FPS: <span id="fps">0</span></p><div class="button-group"><button id="startCamStreamBtn" data-i18n="startStream">Start Stream</button> <button id="stopCamStreamBtn" data-i18n="stopStream">Stop Stream</button></div></div></div><div class="cam-controls"><h2 data-i18n="cameraSettings">Camera Settings</h2><div class="form-grid"><div class="form-group"><label for="camResolution" data-i18n="resolution">Resolution</label> <input type="number" id="camResolution"></div><div class="form-group slider-group"><label for="camQuality"><span data-i18n="quality">Quality</span>: <span id="camQualityValue">20</span></label> <input type="range" value="20" min="4" max="63" id="camQuality"></div><div class="form-group slider-group"><label for="camBright"><span data-i18n="brightness">Brightness</span>: <span id="camBrightValue">0</span></label> <input type="range" value="0" min="-2" max="2" id="camBright"></div><div class="form-group slider-group"><label for="camContrast"><span data-i18n="contrast">Contrast</span>: <span id="camContrastValue">0</span></label> <input type="range" value="0" min="-2" max="2" id="camContrast"></div><div class="form-group slider-group"><label for="camSaturation"><span data-i18n="saturation">Saturation</span>: <span id="camSaturationValue">0</span></label> <input type="range" value="0" min="-2" max="2" id="camSaturation"></div><div class="form-group"><label for="camEffect" data-i18n="effect">Effect</label> <input type="number" id="camEffect"></div><div class="form-group"><label for="camWBMode" data-i18n="wbMode">WB Mode</label> <input type="number" id="camWBMode"></div><div class="form-group slider-group"><label for="camAELevel"><span data-i18n="aeLevel">AE Level</span>: <span id="camAELevelValue">0</span></label> <input type="range" value="0" min="-2" max="2" id="camAELevel"></div><div class="form-group slider-group"><label for="camExpo"><span data-i18n="exposure">Exposure</span>: <span id="camExpoValue">0</span></label> <input type="range" value="0" min="0" max="1200" id="camExpo"></div><div class="form-group slider-group"><label for="camAGCGain"><span data-i18n="agcGain">AGC Gain</span>: <span id="camAGCGainValue">5</span></label> <input type="range" value="5" min="1" max="31" id="camAGCGain"></div><div class="form-group slider-group"><label for="camGainCeiling"><span data-i18n="gainCeiling">Gain Ceiling</span>: <span id="camGainCeilingValue">2</span></label> <input type="range" value="2" min="2" max="128" id="camGainCeiling"></div><div class="control-group"><span data-i18n="awb">AWB</span> <button class="icon-toggle" id="camAwb" data-tooltip-key="awb"></button></div><div class="control-group"><span data-i18n="awbGain">AWB Gain</span> <button class="icon-toggle" id="camAwbGain" data-tooltip-key="awbGain"></button></div><div class="control-group"><span data-i18n="aecSensor">AEC Sensor</span> <button class="icon-toggle" id="camAECSensor" data-tooltip-key="aecSensor"></button></div><div class="control-group"><span data-i18n="aecDsp">AEC DSP</span> <button class="icon-toggle" id="camAECDSP" data-tooltip-key="aecDsp"></button></div><div class="control-group"><span data-i18n="agc">AGC</span> <button class="icon-toggle" id="camAGC" data-tooltip-key="agc"></button></div><div class="control-group"><span data-i18n="bpc">BPC</span> <button class="icon-toggle" id="camBPC" data-tooltip-key="bpc"></button></div><div class="control-group"><span data-i18n="wpc">WPC</span> <button class="icon-toggle" id="camWPC" data-tooltip-key="wpc"></button></div><div class="control-group"><span data-i18n="rawGma">RAW GMA</span> <button class="icon-toggle" id="camRAWGCMA" data-tooltip-key="rawGma"></button></div><div class="control-group"><span data-i18n="lensCorrection">Lens Correction</span> <button class="icon-toggle" id="camLensCorr" data-tooltip-key="lensCorrection"></button></div><div class="control-group"><span data-i18n="hMirror">H-Mirror</span> <button class="icon-toggle" id="camHmirror" data-tooltip-key="hMirror"></button></div><div class="control-group"><span data-i18n="vFlip">V-Flip</span> <button class="icon-toggle" id="camVFlip" data-tooltip-key="vFlip"></button></div><div class="control-group"><span data-i18n="dcw">DCW</span> <button class="icon-toggle" id="camDCW" data-tooltip-key="dcw"></button></div><div class="control-group"><span data-i18n="colorBar">Color Bar</span> <button class="icon-toggle" id="camColorBar" data-tooltip-key="colorBar"></button></div></div><div class="button-group"><button id="getCamConfigBtn" data-i18n="getConfig">Get Config</button> <button id="setCamConfigBtn" data-i18n="setConfig">Set Config</button></div></div></div></div><div id="settings" class="tab-content"><h2 data-i18n="settingsTitle">Settings</h2><div class="form-grid"><div class="form-group"><label data-i18n="language">Language</label><div class="language-selector"><select id="languageSelector"><option value="en">English</option><option value="es">Español</option></select></div></div><div class="form-group"><label data-i18n="theme">Theme</label><div class="theme-switch-wrapper"><em data-i18n="lightMode">Light Mode</em> <label class="theme-switch" for="lightModeToggle"><input type="checkbox" id="lightModeToggle"><div class="slider round"></div></label></div></div></div></div></main></div><div id="tooltip" class="tooltip"></div><script>const JoyStick=function(t,e,i){let n=void 0===(e=e||{}).title?"joystick":e.title,o=void 0===e.width?0:e.width,d=void 0===e.height?0:e.height,r=void 0===e.internalFillColor?"#00AA00":e.internalFillColor,l=void 0===e.internalLineWidth?2:e.internalLineWidth,a=void 0===e.internalStrokeColor?"#003300":e.internalStrokeColor,h=void 0===e.externalLineWidth?2:e.externalLineWidth,c=void 0===e.externalStrokeColor?"#008000":e.externalStrokeColor,u=void 0===e.autoReturnToCenter||e.autoReturnToCenter;i=i||function(t){};let s=document.getElementById(t);s.style.touchAction="none";let f=document.createElement("canvas");f.id=n,0===o&&(o=s.clientWidth),0===d&&(d=s.clientHeight),f.width=o,f.height=d,s.appendChild(f);let v=f.getContext("2d"),g=0,C=2*Math.PI,m=(f.width-(f.width/2+10))/2,p=m+5,L=m+30,w=f.width/2,x=f.height/2,E=f.width/10,S=-1*E,k=f.height/10,y=-1*k,W=w,F=x;function T(){let t="",e=W-w,i=F-x;return i>=y&&i<=k&&(t="C"),i<y&&(t="N"),i>k&&(t="S"),e<S&&("C"===t?t="W":t+="W"),e>E&&("C"===t?t="E":t+="E"),t}return"ontouchstart"in document.documentElement?(f.addEventListener("touchstart",function(t){g=1},!1),f.addEventListener("touchmove",function(t){t.preventDefault(),g&&(W=t.targetTouches[0].pageX-f.offsetLeft,F=t.targetTouches[0].pageY-f.offsetTop)},{passive:!1}),f.addEventListener("touchend",function(t){g=0,u&&(W=w,F=x)},!1)):(f.addEventListener("mousedown",function(t){g=1},!1),document.addEventListener("mousemove",function(t){g&&(W=t.pageX-f.offsetLeft,F=t.pageY-f.offsetTop)},!1),document.addEventListener("mouseup",function(t){g=0,u&&(W=w,F=x)},!1)),setInterval(function(){v.clearRect(0,0,f.width,f.height),v.beginPath(),v.arc(w,x,L,0,C,!1),v.lineWidth=h,v.strokeStyle=c,v.stroke(),function(){v.beginPath(),W<m&&(W=p),W+m>f.width&&(W=f.width-p),F<m&&(F=p),F+m>f.height&&(F=f.height-p),v.arc(W,F,m,0,C,!1);let t=v.createRadialGradient(w,x,5,w,x,200);t.addColorStop(0,r),t.addColorStop(1,a),v.fillStyle=t,v.fill(),v.lineWidth=l,v.strokeStyle=a,v.stroke()}();let t={xPosition:W,yPosition:F,x:((W-w)/m*100).toFixed(),y:((F-x)/m*100).toFixed(),cardinalDirection:T()};i(t)},10),{GetX:()=>((W-w)/m*100).toFixed(),GetY:()=>((F-x)/m*100).toFixed(),GetDir:()=>T()}};</script><script>const translations={en:{menu:"Menu",appTitle:"ESPRC Command Center",lightMode:"Light Mode",joystickA:"Joystick A",joystickB:"Joystick B",connection:"Connection",carConfig:"Car Config",ledConfig:"LED Config",espManage:"ESP32 Manage",camera:"Camera",settings:"Settings",turnLeft:"Turn Left",turnRight:"Turn Right",hazardLights:"Hazard Lights",headlights:"Headlights",swapLayout:"Swap Controls/Joystick",telemetry:"Telemetry",direction:"Direction",controls:"Controls",throttleOnLeft:"Throttle on Left",dir:"Dir",connectionSettings:"Connection Settings",ipAddress:"IP Address",cameraIP:"Camera IP",websocketURL:"WebSocket URL",apiURL:"API URL",wifiMode:"WiFi Mode",client:"Client",accessPoint:"Access Point",wifiSSID:"WiFi SSID",wifiPassword:"WiFi Password",refresh:"Refresh",save:"Save",reconnectWS:"Reconnect WS",carConfiguration:"Car Configuration",maxSpeed:"Max Speed",minSpeed:"Min Speed",alignment:"Alignment",leftTurnLimit:"Left Turn Limit",rightTurnLimit:"Right Turn Limit",enableBluetooth:"Enable Bluetooth",ledConfiguration:"LED Configuration",totalLeds:"Total LEDs in Strip",addGroup:"Add Group",export:"Export",import:"Import",saveLedConfig:"Save LED Config",espManagement:"ESP32 Management",clearNvs:"Clear Configuration (Hard Reset)",restartEsp:"Restart ESP32",startStream:"Start Stream",stopStream:"Stop Stream",cameraSettings:"Camera Settings",resolution:"Resolution",quality:"Quality",brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",effect:"Effect",wbMode:"WB Mode",aeLevel:"AE Level",exposure:"Exposure",agcGain:"AGC Gain",gainCeiling:"Gain Ceiling",lensCorrection:"Lens Correction",hMirror:"H-Mirror",vFlip:"V-Flip",colorBar:"Color Bar",getConfig:"Get Config",setConfig:"Set Config",function:"Function",leds:'LEDs (e.g., "1-5, 8, 10-12")',color:"Color",remove:"Remove",ledFunctions:["FRONT POSITION LIGHT","REAR POSITION LIGHT","BRAKE LIGHT","REVERSE LIGHT","LEFT TURNSIGNAL","RIGHT TURNSIGNAL","INTERIOR LIGHTING","UNDERGLOW"],wifiSavedAlert:"WiFi config saved. The ESP32 will restart.",importSuccessAlert:"LED configuration imported successfully!",importErrorAlert:"Error: Could not import the file. Please ensure it is a valid LED configuration JSON.",restartedAlert:"The ESP32 will restart.",settingsTitle:"Application Settings",language:"Language",theme:"Theme",networkAddresses:"Network Addresses",wifiConfig:"WiFi Configuration",throttleSettings:"Throttle Settings",steeringSettings:"Steering Settings",otherSettings:"Other Settings",autoLights:"Automatic Lights",autoTurnSignals:"Auto Turn Signals",autoTurnTol:"Auto Turn Signals Threshold",awb:"AWB",awbGain:"AWB Gain",aecSensor:"AEC Sensor",aecDsp:"AEC DSP",agc:"AGC",bpc:"BPC",wpc:"WPC",rawGma:"RAW GMA",dcw:"DCW",program:"Program",programTitle:"Program Sequence",uploadProgram:"Upload to ESP",runProgram:"▶️ Run",stopProgram:"⏹️ Stop",clearProgram:"🗑️ Clear All",addAction:"Add Action",loadProgram:"Load from ESP",duplicateAction:"Duplicate Action",deleteAction:"Delete Action"},es:{menu:"Menú",appTitle:"Centro de Comando ESPRC",lightMode:"Modo Claro",joystickA:"Joystick A",joystickB:"Joystick B",connection:"Conexión",carConfig:"Config. Auto",ledConfig:"Config. LED",espManage:"Admin. ESP32",camera:"Cámara",settings:"Ajustes",turnLeft:"Giro Izquierda",turnRight:"Giro Derecha",hazardLights:"Balizas",headlights:"Faros",swapLayout:"Intercambiar Controles/Joystick",telemetry:"Telemetría",direction:"Dirección",controls:"Controles",throttleOnLeft:"Acelerador a Izquierda",dir:"Dir",connectionSettings:"Ajustes de Conexión",ipAddress:"Dirección IP",cameraIP:"IP de la Cámara",websocketURL:"URL de WebSocket",apiURL:"URL de API",wifiMode:"Modo WiFi",client:"Cliente",accessPoint:"Punto de Acceso",wifiSSID:"SSID WiFi",wifiPassword:"Contraseña WiFi",refresh:"Actualizar",save:"Guardar",reconnectWS:"Reconectar WS",carConfiguration:"Configuración del Auto",maxSpeed:"Velocidad Máx.",minSpeed:"Velocidad Mín.",alignment:"Alineación",leftTurnLimit:"Límite Giro Izquierdo",rightTurnLimit:"Límite Giro Derecho",enableBluetooth:"Habilitar Bluetooth",autoTurnSignals:"Intermitentes Automáticos",autoTurnTol:"Umbral Intermitentes Automáticos",ledConfiguration:"Configuración de LEDs",totalLeds:"Total de LEDs en la Tira",addGroup:"Añadir Grupo",export:"Exportar",import:"Importar",saveLedConfig:"Guardar Config. LED",espManagement:"Administración del ESP32",clearNvs:"Limpiar Configuración (Hard Reset)",restartEsp:"Reiniciar ESP32",startStream:"Iniciar Stream",stopStream:"Detener Stream",cameraSettings:"Ajustes de Cámara",resolution:"Resolución",quality:"Calidad",brightness:"Brillo",contrast:"Contraste",saturation:"Saturación",effect:"Efecto",wbMode:"Modo WB",aeLevel:"Nivel AE",exposure:"Exposición",agcGain:"Ganancia AGC",gainCeiling:"Techo de Ganancia",lensCorrection:"Corrección de Lente",hMirror:"Espejo-H",vFlip:"Espejo-V",colorBar:"Barra de Color",getConfig:"Obtener Config.",setConfig:"Establecer Config.",function:"Función",leds:'LEDs (ej. "1-5, 8, 10-12")',color:"Color",remove:"Eliminar",ledFunctions:["LUZ POSICIÓN FRONTAL","LUZ POSICIÓN TRASERA","LUZ DE FRENO","LUZ MARCHA ATRÁS","INTERMITENTE IZQUIERDO","INTERMITENTE DERECHO","LUZ INTERIOR","LUZ BAJOS"],wifiSavedAlert:"Configuración WiFi guardada. El ESP32 se reiniciará.",importSuccessAlert:"¡Configuración de LED importada con éxito!",importErrorAlert:"Error: No se pudo importar el archivo. Asegúrese de que sea un JSON de configuración de LED válido.",restartedAlert:"El ESP32 se reiniciará.",settingsTitle:"Ajustes de la Aplicación",language:"Idioma",theme:"Tema",networkAddresses:"Direcciones de Red",wifiConfig:"Configuración WiFi",throttleSettings:"Ajustes de Aceleración",steeringSettings:"Ajustes de Dirección",otherSettings:"Otros Ajustes",autoLights:"Luces Automáticas",awb:"AWB",awbGain:"Ganancia AWB",aecSensor:"Sensor AEC",aecDsp:"DSP AEC",agc:"AGC",bpc:"BPC",wpc:"WPC",rawGma:"RAW GMA",dcw:"DCW",program:"Programa",programTitle:"Secuencia de Programa",uploadProgram:"Cargar a ESP",runProgram:"▶️ Ejecutar",stopProgram:"⏹️ Detener",clearProgram:"🗑️ Limpiar Todo",addAction:"Añadir Acción",loadProgram:"Cargar desde ESP",duplicateAction:"Duplicar Acción",deleteAction:"Eliminar Acción"}};document.addEventListener("DOMContentLoaded",()=>{const t={hostname:localStorage.getItem("hostname")||window.location.hostname,config:{},wifiConfig:{},ledConfig:{total_leds:12,grupos:[]},lightsState:{turnLeft:!1,turnRight:!1,hazard:!1,headlights:0,acelIzq:!1},activeTab:"joystick-a",wsSocket:null,wsSocketCam:null,socketOnline:!1,socketCamOnline:!1,currentLanguage:"en",tooltipTimeout:null,joystickLayoutSwapped:!1,icons:{turn_left:'<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-big-left-lines"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path stroke="none" fill="currentColor" d="M12 15v3.586a1 1 0 0 1 -1.707 .707l-6.586 -6.586a1 1 0 0 1 0 -1.414l6.586 -6.586a1 1 0 0 1 1.707 .707v3.586h3v6h-3z" /><path d="M21 15v-6" /><path d="M18 15v-6" /></svg>',turn_right:'<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-big-right-lines"><path stroke="none" fill="none" d="M0 0h24v24H0z" /><path stroke="none" fill="currentColor" d="M12 9v-3.586a1 1 0 0 1 1.707 -.707l6.586 6.586a1 1 0 0 1 0 1.414l-6.586 6.586a1 1 0 0 1 -1.707 -.707v-3.586h-3v-6h3z" /><path d="M3 9v6" /><path d="M6 9v6" /></svg>',hazard:'<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-alert-triangle"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 9v4" /><path fill="none"  stroke="currentColor" d="M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z" /><path d="M12 16h.01" /></svg>',headlights_off:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">    <mask id="lineMdCarLightDimmedOff0">        <g fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">            <path stroke-dasharray="12" stroke-dashoffset="0" d="M12 5.5l-9 2.5"/>            <path stroke-dasharray="12" stroke-dashoffset="0" d="M12 10.5l-9 2.5"/>            <path stroke-dasharray="12" stroke-dashoffset="0" d="M12 15.5l-9 2.5"/>            <path stroke="#000" stroke-width="6" d="M21 12c0 -3.31 -3.5 -6.25 -8.25 -6.25c-0.5 0 -1.75 2.75 -1.75 6.25c0 3.5 1.25 6.25 1.75 6.25c4.75 0 8.25 -2.94 8.25 -6.25Z"/>            <path stroke-dasharray="40" stroke-dashoffset="0" d="M21 12c0 -3.31 -3.5 -6.25 -8.25 -6.25c-0.5 0 -1.75 2.75 -1.75 6.25c0 3.5 1.25 6.25 1.75 6.25c4.75 0 8.25 -2.94 8.25 -6.25Z"/>            <path stroke="#000" stroke-dasharray="28" stroke-dashoffset="0" d="M-1 11h26" transform="rotate(45 12 12)"/>            <path stroke-dasharray="28" stroke-dashoffset="0" d="M-1 13h26" transform="rotate(45 12 12)"/>        </g>    </mask>    <rect width="24" height="24" fill="currentColor" mask="url(#lineMdCarLightDimmedOff0)"/></svg>',headlights_pos:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M13 4.8c-4 0-4 14.4 0 14.4s9-2.7 9-7.2s-5-7.2-9-7.2m.1 12.4C12.7 16.8 12 15 12 12s.7-4.8 1.1-5.2C16 6.9 20 8.7 20 12c0 3.3-4.1 5.1-6.9 5.2M8 10.5c0 .5-.1 1-.1 1.5v.6L2.4 14l-.5-1.9L8 10.5M2 7l7.4-1.9c-.2.3-.4.7-.5 1.2c-.1.3-.2.7-.3 1.1L2.5 8.9L2 7m6.2 8.5c.1.7.3 1.4.5 1.9L2.4 19l-.5-1.9l6.3-1.6Z"/></svg>',headlights_low:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">    <mask id="lineMdCarLightFilled0">        <g fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">            <path stroke-dasharray="8" fill="none" stroke-dashoffset="0" d="M11 6h-6"/>            <path stroke-dasharray="8" fill="none" stroke-dashoffset="0" d="M11 10h-6"/>            <path stroke-dasharray="8" fill="none" stroke-dashoffset="0" d="M11 14h-6"/>            <path stroke-dasharray="8" fill="none" stroke-dashoffset="0" d="M11 18h-6"/>            <path fill="none" stroke="#000" stroke-width="6"                d="M21 12c0 -3.31 -3.5 -6.25 -8.25 -6.25c-0.5 0 -1.75 2.75 -1.75 6.25c0 3.5 1.25 6.25 1.75 6.25c4.75 0 8.25 -2.94 8.25 -6.25Z" />            <path fill="none" fill-opacity="1" stroke-dasharray="40" stroke-dashoffset="0"                d="M21 12c0 -3.31 -3.5 -6.25 -8.25 -6.25c-0.5 0 -1.75 2.75 -1.75 6.25c0 3.5 1.25 6.25 1.75 6.25c4.75 0 8.25 -2.94 8.25 -6.25Z"/>        </g>    </mask>    <rect width="24" height="24" fill="currentColor" mask="url(#lineMdCarLightFilled0)"/></svg>',headlights_high:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">    <mask id="lineMdCarLightFilled0">        <g fill="none"    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">            <path stroke-dasharray="8" stroke-dashoffset="0" d="M11 6h-6"/>            <path stroke-dasharray="8" stroke-dashoffset="0" d="M11 10h-6"/>            <path stroke-dasharray="8" stroke-dashoffset="0" d="M11 14h-6"/>            <path stroke-dasharray="8" stroke-dashoffset="0" d="M11 18h-6"/>            <path stroke="#000" stroke-width="6"                d="M21 12c0 -3.31 -3.5 -6.25 -8.25 -6.25c-0.5 0 -1.75 2.75 -1.75 6.25c0 3.5 1.25 6.25 1.75 6.25c4.75 0 8.25 -2.94 8.25 -6.25Z" />            <path fill="#fff" fill-opacity="1" stroke-dasharray="40" stroke-dashoffset="0"                d="M21 12c0 -3.31 -3.5 -6.25 -8.25 -6.25c-0.5 0 -1.75 2.75 -1.75 6.25c0 3.5 1.25 6.25 1.75 6.25c4.75 0 8.25 -2.94 8.25 -6.25Z"/>        </g>    </mask>    <rect width="24" height="24" fill="currentColor" mask="url(#lineMdCarLightFilled0)"/></svg>',bluetooth:'<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 20 20"><path fill="currentColor" d="m9.41 0l6 6l-4 4l4 4l-6 6H9v-7.59l-3.3 3.3l-1.4-1.42L8.58 10l-4.3-4.3L5.7 4.3L9 7.58V0h.41zM11 4.41V7.6L12.59 6L11 4.41zM12.59 14L11 12.41v3.18L12.59 14z"/></svg>',default:'<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 21 21"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m8.5 10.5l-4 4l4 4m8-4h-12m8-12l4 4l-4 4m4-4h-12"/></svg>',acelIzq:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-switch-horizontal"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 3l4 4l-4 4" /><path d="M10 7l10 0" /><path d="M8 13l-4 4l4 4" /><path d="M4 17l9 0" /></svg>',swap:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-switch-horizontal"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 3l4 4l-4 4" /><path d="M10 7l10 0" /><path d="M8 13l-4 4l4 4" /><path d="M4 17l9 0" /></svg>'},elements:{},init(){this.elements={menuLinks:document.querySelectorAll(".menu-link"),tabContents:document.querySelectorAll(".tab-content"),urlWS:document.getElementById("urlWS"),urlAPI:document.getElementById("urlAPI"),lightModeToggle:document.getElementById("lightModeToggle"),languageSelector:document.getElementById("languageSelector"),menuToggle:document.getElementById("menu-toggle"),sidebar:document.getElementById("sidebar"),mainWrapper:document.querySelector(".main-wrapper"),tooltip:document.getElementById("tooltip"),turnLeftBtnA:document.getElementById("turn-left-btn-a"),turnRightBtnA:document.getElementById("turn-right-btn-a"),hazardBtnA:document.getElementById("hazard-btn-a"),headlightsBtnA:document.getElementById("headlights-btn-a"),swapLayoutBtnA:document.getElementById("swap-layout-btn-a"),turnLeftBtnB:document.getElementById("turn-left-btn-b"),turnRightBtnB:document.getElementById("turn-right-btn-b"),hazardBtnB:document.getElementById("hazard-btn-b"),headlightsBtnB:document.getElementById("headlights-btn-b"),acelIzq:document.getElementById("acelIzq")},this.setupLanguage(),this.setupUI(),this.setupEventListeners(),this.initJoysticks(),this.connectWebSockets(),this.loadInitialData(),this.startActionLoop(),this.initLights()},setupLanguage(){const t=localStorage.getItem("language")||"en";this.setLanguage(t),this.elements.languageSelector.value=t},setLanguage(t){this.currentLanguage=t,localStorage.setItem("language",t),document.documentElement.lang=t,document.querySelectorAll("[data-i18n]").forEach(e=>{const n=e.dataset.i18n;translations[t][n]&&(e.textContent=translations[t][n])}),this.ledConfig.grupos&&this.ledConfig.grupos.length>0&&this.renderLedGroups()},setupUI(){this.elements.urlWS.value=`ws://${this.hostname}/ws`,this.elements.urlAPI.value=`${window.location.protocol}//${this.hostname}/`,"light"===localStorage.getItem("theme")&&(document.body.classList.add("light-mode"),this.elements.lightModeToggle.checked=!0),window.innerWidth<=992&&(this.elements.sidebar.classList.add("sidebar-hidden"),this.elements.mainWrapper.classList.add("full-width")),this.joystickLayoutSwapped="true"===localStorage.getItem("joystickLayoutSwapped"),document.getElementById("joystick-a").querySelector(".joystick-layout-single").classList.toggle("swapped",this.joystickLayoutSwapped),document.getElementById("joystick-a").querySelector(".joystick-layout-single").classList.toggle("active",this.joystickLayoutSwapped)},setupEventListeners(){this.elements.languageSelector.addEventListener("change",t=>this.setLanguage(t.target.value)),this.elements.menuToggle.addEventListener("click",()=>{this.elements.sidebar.classList.toggle("sidebar-hidden"),this.elements.mainWrapper.classList.toggle("full-width")}),this.elements.menuLinks.forEach(t=>{t.addEventListener("click",()=>this.openTab(t.dataset.tab))}),document.querySelectorAll('.slider-group input[type="range"]').forEach(t=>{t.addEventListener("input",t=>{const e=document.getElementById(`${t.target.id}Value`);e&&(e.textContent=t.target.value)})}),this.elements.lightModeToggle.addEventListener("change",()=>{document.body.classList.toggle("light-mode"),localStorage.setItem("theme",document.body.classList.contains("light-mode")?"light":"dark"),this.initJoysticks()}),document.getElementById("add-led-group").addEventListener("click",()=>this.addLedGroup()),document.getElementById("import-led-input").addEventListener("change",t=>this.importLedConfig(t)),this.attachClick("getWifiConfigBtn",this.getWifiConfig),this.attachClick("saveWifiConfigBtn",this.saveWifiConfig),this.attachClick("wsReconnectBtn",this.wsReconnect),this.attachClick("getConfigBtn",this.getConfig),this.attachClick("saveConfigBtn",this.saveConfig),this.attachClick("exportLedConfigBtn",this.exportLedConfig),this.attachClick("saveLedConfigBtn",this.saveLedConfig),this.attachClick("manageESPBtn",this.manageESP),this.attachClick("startCamStreamBtn",this.startCamStream),this.attachClick("stopCamStreamBtn",this.stopCamStream),this.attachClick("getCamConfigBtn",this.getCamConfig),this.attachClick("setCamConfigBtn",this.setCamConfig),this.attachClick("uploadProgramBtn",this.uploadProgram),this.attachClick("runProgramBtn",this.runProgram),this.attachClick("stopProgramBtn",this.stopProgram),this.attachClick("clearProgramBtn",this.clearProgram),this.attachClick("addActionBtn",this.showActionModal),this.attachClick("loadProgramBtn",this.loadProgramFromServer);this.elements.swapLayoutBtnA.addEventListener("click",()=>{this.joystickLayoutSwapped=!this.joystickLayoutSwapped,localStorage.setItem("joystickLayoutSwapped",this.joystickLayoutSwapped),document.getElementById("joystick-a").querySelector(".joystick-layout-single").classList.toggle("swapped",this.joystickLayoutSwapped)}),document.querySelectorAll(".icon-toggle, .toggle").forEach(t=>{this.setupTooltipEvents(t)})},attachClick(t,e){const n=document.getElementById(t);n&&n.addEventListener("click",e.bind(this))},initJoysticks(){const t=getComputedStyle(document.documentElement),e={title:"Car Control",autoReturnToCenter:!0,width:300,height:300,internalFillColor:t.getPropertyValue("--joystick-handle-color").trim(),internalStrokeColor:t.getPropertyValue("--joystick-handle-stroke-color").trim(),externalStrokeColor:t.getPropertyValue("--joystick-border-color").trim()};document.getElementById("joy1Div").innerHTML="",document.getElementById("joy2ADiv").innerHTML="",document.getElementById("joy2BDiv").innerHTML="",this.joy1=new JoyStick("joy1Div",e,()=>{}),this.joy2A=new JoyStick("joy2ADiv",e,()=>{}),this.joy2B=new JoyStick("joy2BDiv",e,()=>{})},connectWebSockets(){try{this.wsSocket=new WebSocket(this.elements.urlWS.value),this.wsSocket.onopen=(()=>this.socketOnline=!0),this.wsSocket.onclose=(()=>this.socketOnline=!1),this.wsSocket.onerror=(t=>console.error("Main WS Error:",t))}catch(t){console.error("Failed to create main WebSocket:",t)}},wsReconnect(){this.connectWebSockets()},connectCamWebSocket(t){if(!t||this.socketCamOnline)return;const e=`ws://${t}/ws`;try{this.wsSocketCam=new WebSocket(e),this.wsSocketCam.onmessage=(t=>{document.getElementById("camImg").src=URL.createObjectURL(t.data)}),this.wsSocketCam.onopen=(()=>this.socketCamOnline=!0),this.wsSocketCam.onclose=(()=>this.socketCamOnline=!1),this.wsSocketCam.onerror=(t=>console.error("Cam WS Error:",t))}catch(t){console.error("Failed to create cam WebSocket:",t)}},async fetchAPI(t,e={},n=null){const i=(n||this.elements.urlAPI.value)+t;try{const n=await fetch(i,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return 204===n.status||"POST"===e.method&&"2"===n.headers.get("Content-Length")?null:await n.json()}catch(e){return console.error(`API call to ${t} failed:`,e),null}},loadInitialData(){this.getWifiConfig()},openTab(t){switch(this.activeTab=t,this.elements.tabContents.forEach(t=>t.classList.remove("active")),this.elements.menuLinks.forEach(t=>t.classList.remove("active")),document.getElementById(t).classList.add("active"),document.querySelector(`.menu-link[data-tab="${t}"]`).classList.add("active"),window.innerWidth<=992&&(this.elements.sidebar.classList.add("sidebar-hidden"),this.elements.mainWrapper.classList.add("full-width")),this.updateLightsUI(),t){case"config":this.getConfig();break;case"led-config":this.getLedConfig();break;case"conexion":this.getWifiConfig();break;case"cam":this.getCamConfig()}},startActionLoop(){setInterval(()=>{if(!this.socketOnline)return;let t={};if("joystick-a"===this.activeTab)t={motorSpeed:Math.trunc(1023*Math.abs(this.joy1.GetY())/100),motorDirection:this.joy1.GetY()<0?"F":"B",steerDirection:this.joy1.GetX()<0?"L":"R",steerAng:Math.trunc(512*Math.abs(this.joy1.GetX())/100),ms:500};else{if("joystick-b"!==this.activeTab)return;{const e=document.getElementById("acelIzq").classList.contains("active"),n=e?this.joy2B.GetX():this.joy2A.GetX(),i=e?this.joy2A.GetY():this.joy2B.GetY();t={motorSpeed:Math.trunc(1023*Math.abs(i)/100),motorDirection:i<0?"F":"B",steerDirection:n<0?"L":"R",steerAng:Math.trunc(512*Math.abs(n)/100),ms:500}}}this.wsSocket.send(JSON.stringify(t))},100)},sendWsAction(t){if(!this.socketOnline)return;const e={action:t};this.wsSocket.send(JSON.stringify(e))},initLights(){["A","B"].forEach(t=>{this.elements[`turnLeftBtn${t}`].addEventListener("click",()=>this.handleTurnSignal("left")),this.elements[`turnRightBtn${t}`].addEventListener("click",()=>this.handleTurnSignal("right")),this.elements[`hazardBtn${t}`].addEventListener("click",()=>this.handleHazard()),this.elements[`headlightsBtn${t}`].addEventListener("click",()=>this.handleHeadlights())}),this.elements.acelIzq.addEventListener("click",()=>{this.lightsState.acelIzq=!this.lightsState.acelIzq,this.elements.acelIzq.classList.toggle("active",this.lightsState.acelIzq)}),this.elements.acelIzq.innerHTML=this.icons.acelIzq,this.updateLightsUI()},handleTurnSignal(t){this.lightsState.turnLeft="left"===t&&!this.lightsState.turnLeft,this.lightsState.turnRight="right"===t&&!this.lightsState.turnRight,this.lightsState.hazard&&(this.lightsState.hazard=!1,this.sendWsAction("hazards_toggle")),this.sendWsAction("left"===t?"left_turn_toggle":"right_turn_toggle"),this.updateLightsUI()},handleHazard(){this.lightsState.hazard=!this.lightsState.hazard,this.lightsState.turnLeft=!1,this.lightsState.turnRight=!1,this.sendWsAction("hazards_toggle"),this.updateLightsUI()},handleHeadlights(){this.lightsState.headlights=(this.lightsState.headlights+1)%4,this.sendWsAction("headlights_cycle"),this.updateLightsUI()},updateLightsUI(){const{turnLeft:t,turnRight:e,hazard:n,acelIzq:i}=this.lightsState;this.elements.turnLeftBtnA.classList.toggle("active",t&&!n),this.elements.turnRightBtnA.classList.toggle("active",e&&!n),this.elements.hazardBtnA.classList.toggle("active",n),this.elements.turnLeftBtnB.classList.toggle("active",t&&!n),this.elements.turnRightBtnB.classList.toggle("active",e&&!n),this.elements.hazardBtnB.classList.toggle("active",n),this.elements.acelIzq.classList.toggle("active",i),"joystick-a"===this.activeTab?(this.elements.turnLeftBtnA.innerHTML=this.icons.turn_left,this.elements.turnRightBtnA.innerHTML=this.icons.turn_right,this.elements.hazardBtnA.innerHTML=this.icons.hazard,this.updateButtonIcon(this.elements.headlightsBtnA,this.lightsState.headlights>0,"headlights"),this.elements.turnLeftBtnB.innerHTML="",this.elements.turnRightBtnB.innerHTML="",this.elements.hazardBtnB.innerHTML="",this.elements.headlightsBtnB.innerHTML=""):"joystick-b"===this.activeTab?(this.elements.turnLeftBtnA.innerHTML="",this.elements.turnRightBtnA.innerHTML="",this.elements.hazardBtnA.innerHTML="",this.elements.headlightsBtnA.innerHTML="",this.elements.turnLeftBtnB.innerHTML=this.icons.turn_left,this.elements.turnRightBtnB.innerHTML=this.icons.turn_right,this.elements.hazardBtnB.innerHTML=this.icons.hazard,this.updateButtonIcon(this.elements.headlightsBtnB,this.lightsState.headlights>0,"headlights")):(this.elements.turnLeftBtnA.innerHTML="",this.elements.turnRightBtnA.innerHTML="",this.elements.hazardBtnA.innerHTML="",this.elements.headlightsBtnA.innerHTML="",this.elements.turnLeftBtnB.innerHTML="",this.elements.turnRightBtnB.innerHTML="",this.elements.hazardBtnB.innerHTML="",this.elements.headlightsBtnB.innerHTML=""),this.elements.swapLayoutBtnA.innerHTML=this.icons.swap},updateButtonIcon(t,e,n=null){let i=n;if(i||(i=t.id.includes("Scan")?"bluetooth":"default"),t.id.startsWith("headlights-btn")){const e=`headlights_${["off","pos","low","high"][this.lightsState.headlights]}`;t.innerHTML=this.icons[e]}},updateForm(t){Object.keys(t).forEach(e=>{const n=document.getElementById(e);if(n){if("checkbox"===n.type)n.checked=1==t[e];else if(n.classList.contains("icon-toggle")){const i=1==t[e];n.classList.toggle("active",i),this.updateButtonIcon(n,i)}else n.value=t[e];const i=document.getElementById(`${e}Value`);i&&(i.textContent=t[e])}}),"AP"==t.wifiMode&&(document.getElementById("apMode").checked=!0),"CLI"==t.wifiMode&&(document.getElementById("cliMode").checked=!0)},serializeForm(t){const e=document.querySelector(t),n={};return e.querySelectorAll("input, select").forEach(t=>{t.id&&("checkbox"===t.type?n[t.id]=t.checked?1:0:t.classList.contains("icon-toggle")?n[t.id]=t.classList.contains("active")?1:0:"range"===t.type||"number"===t.type?n[t.id]=parseInt(t.value,10):("SELECT"===t.tagName||"radio"!==t.type||t.checked)&&(n[t.id]=t.value))}),n},setupTooltipEvents(t){t.addEventListener("mouseenter",t=>this.showTooltip(t)),t.addEventListener("mouseleave",t=>this.hideTooltip(t)),t.addEventListener("touchstart",t=>{this.tooltipTimeout=setTimeout(()=>this.showTooltip(t),500)},{passive:!0}),t.addEventListener("touchend",t=>{clearTimeout(this.tooltipTimeout),this.hideTooltip(t)})},showTooltip(t){const e=t.currentTarget,n=e.dataset.tooltipKey;if(!n)return;const i=translations[this.currentLanguage][n]||n;this.elements.tooltip.textContent=i,this.elements.tooltip.classList.add("visible");const o=e.getBoundingClientRect(),a=this.elements.tooltip.getBoundingClientRect();let s=o.top-a.height-8,r=o.left+o.width/2-a.width/2;s<0&&(s=o.bottom+8),r<0&&(r=5),r+a.width>window.innerWidth&&(r=window.innerWidth-a.width-5),this.elements.tooltip.style.top=`${s}px`,this.elements.tooltip.style.left=`${r}px`},hideTooltip(){this.elements.tooltip.classList.remove("visible")},async getWifiConfig(){const t=await this.fetchAPI("wifi");t&&(this.wifiConfig=t,this.updateForm(t))},async saveWifiConfig(){const t={wifiName:document.getElementById("wifiName").value,wifiPass:document.getElementById("wifiPass").value,wifiMode:document.getElementById("cliMode").checked?"CLI":"AP"};await this.fetchAPI("wifi",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}),alert(translations[this.currentLanguage].wifiSavedAlert)},async getConfig(){const t=await this.fetchAPI("config");t&&(this.config=t,this.updateForm(t))},async saveConfig(){const t=this.serializeForm("#config");await this.fetchAPI("config",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}),this.getConfig()},async getLedConfig(){const t=await this.fetchAPI("api/leds");t&&(this.ledConfig=t,this.renderLedGroups())},async saveLedConfig(){const t=document.getElementById("led-groups-container"),e=[];t.querySelectorAll(".led-group-card").forEach(t=>{const n={funcion:parseInt(t.querySelector(".led-function").value,10),leds:t.querySelector(".led-indices").value,color:{r:parseInt(t.querySelector(".led-color").value.substr(1,2),16),g:parseInt(t.querySelector(".led-color").value.substr(3,2),16),b:parseInt(t.querySelector(".led-color").value.substr(5,2),16)},brillo:parseInt(t.querySelector(".led-brightness").value,10)};e.push(n)});const n={total_leds:parseInt(document.getElementById("total_leds").value,10),grupos:e};await this.fetchAPI("api/leds",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}),this.getLedConfig()},exportLedConfig(){const t=document.getElementById("led-groups-container"),e=[];t.querySelectorAll(".led-group-card").forEach(t=>{const n={funcion:parseInt(t.querySelector(".led-function").value,10),leds:t.querySelector(".led-indices").value,color:{r:parseInt(t.querySelector(".led-color").value.substr(1,2),16),g:parseInt(t.querySelector(".led-color").value.substr(3,2),16),b:parseInt(t.querySelector(".led-color").value.substr(5,2),16)},brillo:parseInt(t.querySelector(".led-brightness").value,10)};e.push(n)});const n={total_leds:parseInt(document.getElementById("total_leds").value,10),grupos:e},i="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n,null,2)),o=document.createElement("a");o.setAttribute("href",i),o.setAttribute("download","led_config.json"),document.body.appendChild(o),o.click(),o.remove()},importLedConfig(t){const e=t.target.files[0];if(!e)return;const n=new FileReader;n.onload=(e=>{try{const t=JSON.parse(e.target.result);if("number"!=typeof t.total_leds||!Array.isArray(t.grupos))throw new Error("Invalid JSON format for LED config.");this.ledConfig=t,this.renderLedGroups(),alert(translations[this.currentLanguage].importSuccessAlert)}catch(t){console.error("Failed to import LED config:",t),alert(translations[this.currentLanguage].importErrorAlert)}t.target.value=""}),n.readAsText(e)},renderLedGroups(){document.getElementById("total_leds").value=this.ledConfig.total_leds||12;const t=document.getElementById("led-groups-container");t.innerHTML="";const e=translations[this.currentLanguage].ledFunctions;(this.ledConfig.grupos||[]).forEach((n,i)=>{const o=document.createElement("div");o.className="led-group-card",o.dataset.index=i;const a=e.map((t,e)=>`<option value="${e}" ${n.funcion===e?"selected":""}>${t}</option>`).join(""),s=`#${(n.color.r||0).toString(16).padStart(2,"0")}${(n.color.g||0).toString(16).padStart(2,"0")}${(n.color.b||0).toString(16).padStart(2,"0")}`;o.innerHTML=`\n                    <div class="form-group"><label>${translations[this.currentLanguage].function}</label><select class="led-function">${a}</select></div>\n                    <div class="form-group"><label>${translations[this.currentLanguage].leds}</label><input type="text" class="led-indices" value="${n.leds||""}"></div>\n                    <div class="form-group"><label>${translations[this.currentLanguage].color}</label><input type="color" class="led-color" value="${s}"></div>\n                    <div class.form-group slider-group">\n                        <label>${translations[this.currentLanguage].brightness}: <span class="led-brightness-value">${n.brillo||100}</span></label>\n                        <input type="range" class="led-brightness" min="0" max="100" value="${n.brillo||100}">\n                    </div>\n                    <button class="remove-led-group danger">${translations[this.currentLanguage].remove}</button>`,t.appendChild(o)}),t.querySelectorAll(".remove-led-group").forEach(t=>t.addEventListener("click",t=>this.removeLedGroup(t.target))),t.querySelectorAll(".led-brightness").forEach(t=>{t.addEventListener("input",t=>{t.target.closest(".slider-group").querySelector(".led-brightness-value").textContent=t.target.value})})},addLedGroup(){this.ledConfig.grupos||(this.ledConfig.grupos=[]),this.ledConfig.grupos.push({funcion:0,leds:"",color:{r:255,g:255,b:255},brillo:100}),this.renderLedGroups()},removeLedGroup(t){const e=t.closest(".led-group-card"),n=parseInt(e.dataset.index,10);this.ledConfig.grupos.splice(n,1),this.renderLedGroups()},async manageESP(){const t={clearPreferences:document.getElementById("clearPreferences").checked,restartESP:!0};await this.fetchAPI("manage",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}),alert(translations[this.currentLanguage].restartedAlert)},async getCamConfig(){const t=`${window.location.protocol}//${this.wifiConfig.camIP}/`,e=await this.fetchAPI("cam-config",{},t);e&&this.updateForm(e)},async setCamConfig(){const t=`${window.location.protocol}//${this.wifiConfig.camIP}/`,e=this.serializeForm("#cam .cam-controls");await this.fetchAPI("cam-config",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}},t)},async startCamStream(){const t=`${window.location.protocol}//${this.wifiConfig.camIP}/`;await this.fetchAPI("enable-stream",{},t)},async stopCamStream(){const t=`${window.location.protocol}//${this.wifiConfig.camIP}/`;await this.fetchAPI("disable-stream",{},t)},programSequence:[],draggedIndex:null,async uploadProgram(){this.updateSequenceFromUI();const t=this.programSequence.map(t=>"lights"===t.action?{action:t.lightAction,duration:t.duration}:t);await this.fetchAPI("api/program",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})},async runProgram(){await this.fetchAPI("api/program/run")},async stopProgram(){await this.fetchAPI("api/program/stop")},async clearProgram(){await this.fetchAPI("api/program/clear"),this.programSequence=[],this.renderProgramSequence()},async loadProgramFromServer(){const t=await this.fetchAPI("api/program");t&&(this.programSequence=t.map(t=>{const e={duration:t.duration};return"move"===t.action||"wait"===t.action?(e.action=t.action,"move"===t.action&&(e.motorSpeed=t.motorSpeed,e.steerAngle=t.steerAngle)):(e.action="lights",e.lightAction=t.action),e}),this.renderProgramSequence())},showActionModal(){document.body.insertAdjacentHTML("beforeend",'\n                <div class="modal-overlay" id="action-modal-overlay">\n                    <div class="modal-content">\n                        <h3 data-i18n="addAction">Add Action</h3>\n                        <div class="modal-actions">\n                            <button class="modal-action-btn" data-action-type="move">Move & Steer</button>\n                            <button class="modal-action-btn" data-action-type="wait">Wait</button>\n                            <button class="modal-action-btn" data-action-type="lights">Lights</button>\n                        </div>\n                        <button id="close-modal-btn" class="danger">Cancel</button>\n                    </div>\n                </div>\n            '),document.getElementById("action-modal-overlay").addEventListener("click",t=>{"action-modal-overlay"!==t.target.id&&"close-modal-btn"!==t.target.id||document.getElementById("action-modal-overlay").remove()}),document.querySelectorAll(".modal-action-btn").forEach(t=>{t.addEventListener("click",t=>{this.addAction(t.target.dataset.actionType),document.getElementById("action-modal-overlay").remove()})})},addAction(t){const e={action:t,duration:1e3};"move"===t?(e.motorSpeed=0,e.steerAngle=0):"lights"===t&&(e.lightAction="lights_cycle"),this.programSequence.push(e),this.renderProgramSequence()},deleteAction(t){this.programSequence.splice(t,1),this.renderProgramSequence()},duplicateAction(t){this.updateSequenceFromUI();const e=JSON.parse(JSON.stringify(this.programSequence[t]));this.programSequence.splice(t+1,0,e),this.renderProgramSequence()},updateSequenceFromUI(){const t=document.getElementById("program-sequence-container"),e=[];t.querySelectorAll(".action-card").forEach(t=>{const n=parseInt(t.dataset.index,10),i={action:this.programSequence[n].action,duration:parseInt(t.querySelector(".action-duration-number").value,10)};"move"===i.action&&(i.motorSpeed=parseInt(t.querySelector(".action-speed").value,10),i.steerAngle=parseInt(t.querySelector(".action-steer").value,10)),"lights"===i.action&&(i.lightAction=t.querySelector(".action-light-select").value),e.push(i)}),this.programSequence=e},renderProgramSequence(){const t=document.getElementById("program-sequence-container");t.innerHTML="",this.programSequence.forEach((e,n)=>{const i=document.createElement("div");i.className="action-card",i.dataset.index=n,i.innerHTML=this.getActionCardHTML(e,n),t.appendChild(i)}),this.attachActionCardListeners()},getActionCardHTML(t,e){const n=`\n                <div class="action-card-header">\n                    <span class="drag-handle" draggable="true">↕️</span>\n                    <h5 data-i18n="action_${t.action}">${t.action.replace("_"," ").toUpperCase()}</h5>\n                    <div>\n                        <button class="duplicate-action-btn secondary" data-index="${e}" data-tooltip-key="duplicateAction">❐</button>\n                        <button class="delete-action-btn danger" data-index="${e}" data-tooltip-key="deleteAction">X</button>\n                    </div>\n                </div>`;let i="";return"move"===t.action&&(i=`\n                    <div class="form-grid">\n                        <div class="form-group slider-group">\n                            <label>Speed: <span id="action-speed-value-${e}">${t.motorSpeed}</span></label>\n                            <input type="range" class="action-speed" min="-255" max="255" value="${t.motorSpeed}">\n                        </div>\n                        <div class="form-group slider-group">\n                            <label>Steer: <span id="action-steer-value-${e}">${t.steerAngle}</span></label>\n                            <input type="range" class="action-steer" min="-550" max="550" value="${t.steerAngle}">\n                        </div>\n                    </div>`),"lights"===t.action&&(i=`\n                    <div class="form-group">\n                        <label data-i18n="lightAction">Light Action</label>\n                        <select class="action-light-select">\n                            <option value="lights_cycle" ${"lights_cycle"===t.lightAction?"selected":""}>Cycle Headlights</option>\n                            <option value="hazards_toggle" ${"hazards_toggle"===t.lightAction?"selected":""}>Toggle Hazards</option>\n                            <option value="left_turn_toggle" ${"left_turn_toggle"===t.lightAction?"selected":""}>Toggle Left Turn</option>\n                            <option value="right_turn_toggle" ${"right_turn_toggle"===t.lightAction?"selected":""}>Toggle Right Turn</option>\n                        </select>\n                    </div>`),n+'<div class="action-card-body">'+i+`\n                <div class="action-card-footer">\n                    <div class="form-group duration-group">\n                        <label>Duration (ms)</label>\n                        <div class="duration-controls">\n                            <input type="range" class="action-duration-slider" min="100" max="10000" value="${t.duration}">\n                            <input type="number" class="action-duration-number" value="${t.duration}" min="100">\n                        </div>\n                    </div>\n                </div>`+"</div>"},attachActionCardListeners(){document.querySelectorAll(".delete-action-btn").forEach(t=>{t.onclick=(t=>{t.stopPropagation(),this.deleteAction(parseInt(t.currentTarget.dataset.index,10))})}),document.querySelectorAll(".duplicate-action-btn").forEach(t=>{t.onclick=(t=>{t.stopPropagation(),this.duplicateAction(parseInt(t.currentTarget.dataset.index,10))})}),document.querySelectorAll(".action-card .icon-toggle, .action-card .toggle, .action-card .danger, .action-card .secondary").forEach(t=>{this.setupTooltipEvents(t)}),document.querySelectorAll('.action-card input[type="range"]').forEach(t=>{t.addEventListener("input",t=>{if(t.target.previousElementSibling){const e=t.target.previousElementSibling.querySelector("span");e&&(e.textContent=t.target.value)}});const e=t.closest(".action-card").querySelector(".drag-handle");t.addEventListener("touchstart",()=>e.setAttribute("draggable",!1),{passive:!0}),t.addEventListener("touchend",()=>e.setAttribute("draggable",!0),{passive:!0})}),document.querySelectorAll(".duration-group").forEach(t=>{const e=t.querySelector(".action-duration-slider"),n=t.querySelector(".action-duration-number");e.addEventListener("input",()=>n.value=e.value),n.addEventListener("input",()=>e.value=n.value)});const t=document.getElementById("program-sequence-container");document.querySelectorAll(".drag-handle").forEach(t=>{t.addEventListener("dragstart",t=>{const e=t.currentTarget.closest(".action-card");this.draggedIndex=parseInt(e.dataset.index,10),setTimeout(()=>e.classList.add("dragging"),0)}),t.addEventListener("dragend",t=>{const e=t.currentTarget.closest(".action-card");e&&e.classList.remove("dragging"),this.draggedIndex=null})}),t.addEventListener("dragover",e=>{e.preventDefault();const n=this.getDragAfterElement(t,e.clientY),i=document.querySelector(".dragging");i&&(null==n?t.appendChild(i):t.insertBefore(i,n))}),t.addEventListener("drop",t=>{t.preventDefault(),this.updateSequenceFromUI(),this.renderProgramSequence()})},getDragAfterElement:(t,e)=>[...t.querySelectorAll(".action-card:not(.dragging)")].reduce((t,n)=>{const i=n.getBoundingClientRect(),o=e-i.top-i.height/2;return o<0&&o>t.offset?{offset:o,element:n}:t},{offset:Number.NEGATIVE_INFINITY}).element};window.app=t,t.init()});</script></body></html>